{{extend 'layout.html'}}

{{block head}}
<script src="{{=URL('static', 'js/vue.js')}}"></script>
<script>
    var get_users_url = "{{=URL('user_api', 'get_users', user_signature=True)}}";
    var user_data_url = "{{=URL('user_api', 'get_user_data', user_signature=True)}}";
    var add_surf_session_url = "{{=URL('user_api', 'add_surf_session', user_signature=True)}}";
    var delete_surf_session_url = "{{=URL('user_api', 'delete_surf_session', user_signature=True)}}";
</script> 
<link href="{{=URL('static','css/surf.css')}}" rel="stylesheet" type="text/css"/>
<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
{{end}}

<div class="main_content">

	<div id="vue-div" class="surf">

    <div class="container padded">

      <h2 class="page_title" >Surf Page</h2>

  		<div class="container padded half">

        <div class="blue padded surf_window">
          <h4>Set the time window you would like to surf:</h4>
          <section class="range-slider">
            <h6 class="rangeValues"></h6>
            <input value="0" min="0" max="1440" step="30" type="range">
            <input value="480" min="0" max="1440" step="30" type="range">
          </section>
        </div>

        <div class="navy padded">
          <h5>Get a recommendation!</h5>
          <button class="btn rounded" v-on:click="surf()">Request Recommendation</button>
           <div v-if="calculating" class="progress fill"><div class="indeterminate"></div></div>
          <h5>Best Surf: ${best_spot_message}</h5>
          <h5>Second Best Surf: ${best_spot_message2}</h5>
          <h5>Third Best Surf: ${best_spot_message3}</h5>

          <button v-on:click="confirm_surf_session()" v-if="best_spot_message" class="btn rounded"> Confirm Surf Session </button>
        </div>
      </div>

      <div class="container padded half">
        <div class="green padded">
          <h5>Your Surf Sessions</h5>
          <div class="silver padded tags dismissible">
              <span v-for="(session, index) in user_data.surf_sessions" v-on:click="delete_surf_session(index)" class="tags"> ${session} </span>
          </div>
        </div>
      </div>

	 </div>
	</div>
<div id="map"></div>
  <style>
  #map {
    height: 100%;
  }
  html, body {
    height: 100%;
    margin: 0;
    padding: 0;
  }
  </style>
  <script>
    var map;
    //sets up the blank intial map of santa cruz
    async function initMap() {
      var santa_cruz = {lat: 36.9741, lng: -122.0308};
      map = new google.maps.Map(document.getElementById('map'), {
        center: santa_cruz,
        zoom: 11
      });
    }
    //adds a marker with wave height on each surf spot 
    async function setMarkers(timeToCheck, bestSpotMessage1, bestSpotMessage2, bestSpotMessage3){
      var bestSpot1 = bestSpotMessage1.split(",");
      var bestSpot2 = bestSpotMessage2.split(",");
      var bestSpot3 = bestSpotMessage3.split(",");
      var bestImage = {
        url: 'https://developers.google.com/maps/documentation/javascript/examples/full/images/beachflag.png',
        // This marker is 20 pixels wide by 32 pixels high.
        size: new google.maps.Size(20, 32),
        // The origin for this image is (0, 0).
        origin: new google.maps.Point(0, 0),
        // The anchor for this image is the base of the flagpole at (0, 32).
        anchor: new google.maps.Point(0, 32)
      };
      const spotResponse = await axios.get("http://api.spitcast.com/api/county/spots/santa-cruz/");
      for(var i = 0; i < spotResponse.data.length; i++){
        this_id = spotResponse.data[i].spot_id;
        const spotForecast = await axios.get("http://api.spitcast.com/api/spot/forecast/" + this_id + "/",
                { params: {dcat:"week"}});
        size_ft = Math.round(spotForecast.data[timeToCheck].size_ft * 100) / 100;
        spot_lat = spotResponse.data[i].latitude;
        spot_long = spotResponse.data[i].longitude;
        spot_name = spotResponse.data[i].spot_name;
        //best spots get different image and bounce
        if(spot_name == bestSpot1[0] || spot_name == bestSpot2[0] || spot_name == bestSpot3[0]){
          var marker = new google.maps.Marker({
            position: {lat: spot_lat, lng: spot_long}, 
            map: map,
            icon: bestImage,
            animation: google.maps.Animation.BOUNCE,
            title: spot_name + "\nWaves: " + size_ft + " ft",
            zIndex: 1
          });
        }
        else{
          var marker = new google.maps.Marker({
            position: {lat: spot_lat, lng: spot_long}, 
            map: map,
            animation: google.maps.Animation.DROP,
            title: spot_name + "\nWaves: " + size_ft + " ft",
            zIndex: 2
          });
        }
      }
    }
    </script>
</div>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB3LsflDKQc7kTbiocVBAt-qZO4qJQvEEg&callback=initMap" async defer></script>
<script src="https://unpkg.com/vue"></script>
<script src="{{=URL('static', 'js/surf.js')}}"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>

